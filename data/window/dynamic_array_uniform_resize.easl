@{address storage
  group 0
  binding 0}
(var my-array: [vec4f])

@{address uniform
  group 0
  binding 1}
(var frame-index: u32)

@vertex
(defn trivial-vertex [@{builtin vertex-index}
                      vertex-index: u32]: @{builtin position} vec4f
  (vec4f (match vertex-index
           0 (vec2f -1.)
           1 (vec2f -1. 3.)
           _ (vec2f 3. -1.))
         0.
         1.))

@fragment
(defn my-fragment [@{builtin position} pos: vec4f]: @{location 0} vec4f
  (vec4f (match (array-length my-array)
           1 (.xyz (my-array 0u))
           _ (vec3f 0. 1. 0.))
         1.))

@cpu
(defn main []
  (spawn-window (fn []
                    (+= frame-index 1)
                    (let [t (f32 frame-index)]
                      (= my-array
                         (match (% (/ frame-index 60) 3)
                           0 (into-dynamic-array [(vec4f 0.) (vec4f 0.)])
                           1 (into-dynamic-array [(vec4f 1. 0. 0. 0.)])
                           _ (into-dynamic-array [(vec4f 1.)]))))
                    (dispatch-render-shaders trivial-vertex my-fragment 3))))
